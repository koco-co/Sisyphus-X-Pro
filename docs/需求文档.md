# Sisyphus-X-Pro 功能需求文档

**版本**: v1.0.0
**日期**: 2026-02-14
**面向对象**: 开发团队、测试团队

---

## 项目概述

Sisyphus-X-Pro 是一款 YAML 驱动的企业级自动化测试管理平台，整合项目配置、接口定义、场景编排、测试计划、测试报告全流程。

**技术栈**:
- 前端: React 18 + TypeScript 5.0 + Vite + TailwindCSS v4 + shadcn/ui
- 后端: FastAPI + Python 3.12 + SQLAlchemy 2.0 + asyncpg
- 中间件: PostgreSQL 15+ + MinIO + Redis
- 核心执行器: pytest + sisyphus-api-engine

---

## 功能模块

### 1. 用户认证 (AUTH-001 ~ AUTH-008)

#### 1.1 邮箱注册/登录

**功能描述**:
- 用户通过邮箱 + 密码注册
- 用户通过邮箱 + 密码登录
- 密码使用 bcrypt 哈希存储
- 登录成功返回 JWT Token，有效期 7 天
- Token 存储在 localStorage

**验收标准**:
- [ ] 支持邮箱格式验证
- [ ] 密码长度 8-20 位
- [ ] 注册时二次确认密码
- [ ] 登录态刷新页面不丢失
- [ ] 所有 API 请求自动携带 JWT Token
- [ ] 开发模式(APP_ENV=development)可跳过 JWT 验证

#### 1.2 OAuth 单点登录

**功能描述**:
- 支持 GitHub OAuth 单点登录
- 支持 Google OAuth 单点登录
- OAuth 用户可无密码注册

**验收标准**:
- [ ] GitHub OAuth 授权成功后自动登录
- [ ] Google OAuth 授权成功后自动登录
- [ ] OAuth 新用户自动创建账户
- [ ] OAuth 老用户直接登录

---

### 2. 项目管理 (PROJ-001 ~ PROJ-006)

#### 2.1 项目 CRUD

**功能描述**:
- 创建项目: 项目名称、描述
- 编辑项目信息
- 删除项目(二次确认)
- 项目列表分页展示
- 按项目名称查询

**验收标准**:
- [ ] 列表字段: 项目名称、描述、创建时间、更新时间、操作列
- [ ] 操作列包含: 编辑、数据库配置、删除
- [ ] 删除时二次确认弹窗
- [ ] 全局 Toast 提示(右上角 + 进度条)
- [ ] 支持分页: 页码跳转、每页条数切换

#### 2.2 数据库配置

**功能描述**:
- 配置 MySQL/PostgreSQL 数据库连接
- 测试数据库连接
- 连接状态自动检测(每 10 分钟)
- 启用/禁用配置

**数据表**:
```sql
CREATE TABLE database_configs (
    id UUID PRIMARY KEY,
    project_id UUID REFERENCES projects(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,           -- 连接名称
    variable_name VARCHAR(255),            -- 引用变量名
    db_type VARCHAR(50) NOT NULL,          -- MySQL / PostgreSQL
    host VARCHAR(255) NOT NULL,
    port INTEGER NOT NULL,
    initial_database VARCHAR(255),
    username VARCHAR(255) NOT NULL,
    password VARCHAR(255) NOT NULL,         -- 加密存储
    is_enabled BOOLEAN DEFAULT TRUE,
    connection_status VARCHAR(50),          -- connected / failed / unknown
    last_tested_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(project_id, variable_name)
);
```

**验收标准**:
- [ ] 创建数据库配置需填写: 连接名称、引用变量、主机、端口、初始数据库、用户名、密码
- [ ] 点击"测试连接"按钮，测试通过后才能保存
- [ ] 连接状态每 10 分钟自动检测一次
- [ ] 支持启用/禁用开关
- [ ] 列表字段: 连接名称、引用变量、配置信息(脱敏)、连接状态、启用状态
- [ ] 操作列: 编辑、删除

---

### 3. 关键字配置 (KEYW-001 ~ KEYW-005)

#### 3.1 内置关键字

**功能描述**:
内置关键字不可删除和编辑，但可查看代码:

| 类型 | 名称 | 描述 |
|------|------|------|
| 发送请求 | HTTP 请求 | 支持 requests 库所有 HTTP 方法 |
| 断言类型 | JSON、Header、Cookie、环境变量、HTTP Code、耗时 | |
| 提取变量 | JSON、Header、Cookie | 支持 JSONPath 提取 |
| 数据库操作 | 选择数据源、输入 SQL | 支持断言和提取变量 |
| 自定义操作 | 占位符 | |

**验收标准**:
- [ ] 内置关键字代码可查看(回显在前端)
- [ ] 内置关键字不可编辑和删除
- [ ] 列表字段: 关键字类型、名称、方法名、启用状态、操作列

#### 3.2 自定义关键字

**功能描述**:
- 创建自定义关键字: 类型、名称、方法名、代码块、入参释义
- 使用 Monaco Editor 编辑代码块
- 编辑和删除自定义关键字
- 启用/禁用关键字

**数据表**:
```sql
CREATE TABLE keywords (
    id UUID PRIMARY KEY,
    project_id UUID REFERENCES projects(id) ON DELETE CASCADE,  -- NULL 表示内置
    type VARCHAR(50) NOT NULL,      -- request / assertion / extract / db / custom
    name VARCHAR(255) NOT NULL,
    method_name VARCHAR(255) NOT NULL,
    code TEXT NOT NULL,             -- Python 代码块
    parameters JSONB,               -- 入参释义 [{name, description}]
    is_builtin BOOLEAN DEFAULT FALSE,
    is_enabled BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(project_id, name)
);
```

**验收标准**:
- [ ] 使用 Monaco Editor 编辑代码块
- [ ] 支持编辑和删除自定义关键字
- [ ] 支持启用/禁用关键字(默认启用)
- [ ] 禁用的关键字不在场景编排下拉框中显示

---

### 4. 接口定义 (INTF-001 ~ INTF-006)

#### 4.1 接口目录树

**功能描述**:
- 创建接口目录
- 支持拖拽排序
- 接口和目录的增删改查

**数据表**:
```sql
CREATE TABLE interface_folders (
    id UUID PRIMARY KEY,
    project_id UUID NOT NULL REFERENCES projects(id) ON DELETE CASCADE,
    parent_id UUID REFERENCES interface_folders(id) ON DELETE SET NULL,
    name VARCHAR(255) NOT NULL,
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**验收标准**:
- [ ] 支持创建多级目录
- [ ] 支持拖拽排序(同级目录内)
- [ ] 支持删除目录(级联删除子目录和接口)

#### 4.2 接口定义

**功能描述**:
- 手动填写接口信息
- cURL 命令导入
- 接口属性: 接口名称、请求方式、URL、请求头、请求体、断言规则
- 支持 Swagger 导入(Post-MVP)

**数据表**:
```sql
CREATE TABLE interfaces (
    id UUID PRIMARY KEY,
    project_id UUID NOT NULL REFERENCES projects(id) ON DELETE CASCADE,
    folder_id UUID REFERENCES interface_folders(id) ON DELETE SET NULL,
    name VARCHAR(255) NOT NULL,
    method VARCHAR(10) NOT NULL,     -- GET / POST / PUT / DELETE / PATCH
    url TEXT NOT NULL,
    headers JSONB,
    body JSONB,
    assertions JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**验收标准**:
- [ ] 支持手动填写接口信息
- [ ] 支持 cURL 命令导入
- [ ] 接口调试中，file 参数上传到 MinIO(按项目分桶)
- [ ] 支持接口拖拽排序(同级目录内)

#### 4.3 环境管理

**功能描述**:
- 创建多个环境: 环境名称、前置 URL
- 全局变量(所有环境可用)
- 环境变量(当前环境可用)
- 支持 `{{变量名}}` 引用变量

**数据表**:
```sql
CREATE TABLE environments (
    id UUID PRIMARY KEY,
    project_id UUID NOT NULL REFERENCES projects(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    base_url VARCHAR(1024),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(project_id, name)
);

CREATE TABLE env_variables (
    id UUID PRIMARY KEY,
    environment_id UUID REFERENCES environments(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    value TEXT NOT NULL,
    description TEXT,
    is_global BOOLEAN DEFAULT FALSE,   -- TRUE 表示全局变量
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(environment_id, name, is_global)
);
```

**验收标准**:
- [ ] 右上角支持切换运行环境(显示环境名称)
- [ ] 旁边有环境管理按钮，点击进入弹窗页面
- [ ] 支持配置全局变量(手动设置、提取变量设置)
- [ ] 支持配置环境变量(手动设置、提取变量设置)
- [ ] 变量支持: 变量名、变量值、变量描述
- [ ] 接口中支持 `{{变量名}}` 引用

---

### 5. 场景编排 (SCEN-001 ~ SCEN-007)

#### 5.1 测试场景 CRUD

**功能描述**:
- 创建测试场景: 项目、名称、描述、优先级(P0~P3)、标签
- 编辑和删除测试场景
- 分页列表展示
- 按场景名称和项目查询

**数据表**:
```sql
CREATE TABLE scenarios (
    id UUID PRIMARY KEY,
    project_id UUID NOT NULL REFERENCES projects(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    priority VARCHAR(10) DEFAULT 'P2',   -- P0 / P1 / P2 / P3
    tags JSONB,                         -- [tag1, tag2, ...]
    created_by UUID NOT NULL REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**验收标准**:
- [ ] 列表字段: 所属项目、场景名称、描述、操作列
- [ ] 操作列包含: 编辑、删除
- [ ] 支持分页和查询

#### 5.2 测试步骤编排

**功能描述**:
- 测试步骤列表: 支持增删改、拖拽排序
- 步骤配置: 步骤描述、关键字操作、关键字参数
- 关键字联动: 层层筛选(类型 → 名称 → 参数)
- 前置/后置 SQL(Monaco Editor)

**数据表**:
```sql
CREATE TABLE scenario_steps (
    id UUID PRIMARY KEY,
    scenario_id UUID NOT NULL REFERENCES scenarios(id) ON DELETE CASCADE,
    description TEXT,
    keyword_type VARCHAR(50) NOT NULL,
    keyword_name VARCHAR(255) NOT NULL,
    parameters JSONB,
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**验收标准**:
- [ ] 基础信息: 项目、名称、描述、优先级、标签
- [ ] Tab 切换: 测试步骤 | 变量定义 | 前置 SQL | 后置 SQL
- [ ] 步骤支持拖拽排序(@dnd-kit)
- [ ] 选择"发送请求"后，可选择项目中的接口(目录-接口筛选，支持按名称搜索)
- [ ] 选择"断言类型"后，可配置断言规则(JSONPath 表达式、判断符号、预期结果)
- [ ] 选择"提取变量"后，可配置提取规则(JSONPath 表达式、变量名称、变量类型)
- [ ] 选择"数据库操作"后，可选择数据源并输入 SQL
- [ ] 前置/后置 SQL 支持 `{{变量名}}` 引用
- [ ] 前置/后置 SQL 支持动态传参，如 `source_table_{{random(12)}}`

#### 5.3 数据驱动测试

**功能描述**:
- 创建测试数据集: 数据集名称
- 手动输入测试数据
- 导入/导出 CSV
- 在接口中通过 `{{变量名}}` 引用数据

**数据表**:
```sql
CREATE TABLE datasets (
    id UUID PRIMARY KEY,
    project_id UUID NOT NULL REFERENCES projects(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    csv_data TEXT NOT NULL,              -- CSV 格式数据
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**验收标准**:
- [ ] 右侧边栏支持切换测试数据集(默认不使用)
- [ ] 下拉框右边按钮点击后，抽屉展开新建数据集页面
- [ ] 支持手动输入测试数据
- [ ] 支持导入 CSV
- [ ] 支持导出 CSV(无数据时作为导入模板)
- [ ] CSV 数据包含表头和数据，一一对应
- [ ] 调试时，数据驱动是并行执行，N 行数据 = N 个 YAML 文件

#### 5.4 场景调试

**功能描述**:
- 点击调试按钮调用 sisyphus-api-engine
- 执行完成后自动跳转 Allure 报告
- 调试结果不记录在测试报告模块，不持久化
- 调试结果放在 `temp/${登录账号}/report` 下

**验收标准**:
- [ ] 点击调试按钮立即调用 sisyphus-api-engine
- [ ] 执行完成后自动跳转 Allure 报告页面
- [ ] 下一次调试后自动删除上一次的调试结果
- [ ] 不会删除其他用户的调试结果

---

### 6. 测试计划 (PLAN-001 ~ PLAN-006)

#### 6.1 测试计划 CRUD

**功能描述**:
- 创建测试计划: 测试计划名称、所属项目、描述
- 编辑和删除测试计划
- 分页列表展示
- 按测试计划名称和项目查询

**数据表**:
```sql
CREATE TABLE test_plans (
    id UUID PRIMARY KEY,
    project_id UUID NOT NULL REFERENCES projects(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    created_by UUID NOT NULL REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**验收标准**:
- [ ] 列表字段: 所属项目、测试计划名称、操作列
- [ ] 操作列包含: 编辑、执行、复制、查看图表、删除

#### 6.2 测试场景编排

**功能描述**:
- 编排测试场景: 支持拖拽排序
- 支持增删改查测试场景
- 添加测试场景抽屉: 支持项目筛选、场景名称搜索、分页展示

**数据表**:
```sql
CREATE TABLE plan_scenarios (
    id UUID PRIMARY KEY,
    test_plan_id UUID NOT NULL REFERENCES test_plans(id) ON DELETE CASCADE,
    scenario_id UUID NOT NULL REFERENCES scenarios(id) ON DELETE CASCADE,
    dataset_id UUID REFERENCES datasets(id) ON DELETE SET NULL,
    environment_id UUID REFERENCES environments(id) ON DELETE SET NULL,
    variables JSONB,                    -- 场景变量覆盖
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**验收标准**:
- [ ] 基础信息: 测试计划名称、所属项目、描述
- [ ] 测试场景: 支持拖拽排序，支持增删改查
- [ ] 添加测试场景抽屉:
  - [ ] 支持项目筛选(默认选择基础信息中的所属项目)
  - [ ] 支持场景名称搜索
  - [ ] 支持分页展示
  - [ ] 列表显示: 场景名称、描述、优先级、标签、添加按钮
- [ ] 测试场景列表显示: 场景名称、变量依赖、引用数据集、操作列(编辑、删除)
- [ ] 测试场景顺序执行，数据驱动并行执行

#### 6.3 测试执行

**功能描述**:
- 点击执行按钮，下钻到执行计划页面
- 执行计划页面列表显示: 场景名称、优先级、标签、运行环境、运行结果、创建时间、创建人
- 实时进度监控: WebSocket 推送
- 终止/暂停/恢复控制

**数据表**:
```sql
CREATE TABLE test_executions (
    id UUID PRIMARY KEY,
    test_plan_id UUID NOT NULL REFERENCES test_plans(id) ON DELETE CASCADE,
    status VARCHAR(50) DEFAULT 'running',  -- running / completed / terminated / paused / failed
    started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP,
    created_by UUID NOT NULL REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE execution_steps (
    id UUID PRIMARY KEY,
    execution_id UUID NOT NULL REFERENCES test_executions(id) ON DELETE CASCADE,
    scenario_id UUID NOT NULL REFERENCES scenarios(id),
    status VARCHAR(50) DEFAULT 'pending',  -- pending / running / passed / failed / skipped
    result JSONB,
    started_at TIMESTAMP,
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**验收标准**:
- [ ] 执行计划页面列表显示: 场景名称、优先级、标签、运行环境、运行结果(通过、失败、跳过)、创建时间、创建人
- [ ] 支持分页和查询
- [ ] 点击场景名称，跳转到场景编排详情页
- [ ] 鼠标悬浮运行结果，显示最近运行时间、通过指标、性能指标
- [ ] 支持批量选择测试场景并运行
- [ ] 执行页面:
  - [ ] 面包屑左侧: 测试计划名称
  - [ ] 面包屑右侧: 终止、暂停按钮
  - [ ] 左侧: 实时运行组件(场景总数、通过数、失败数)
  - [ ] 中间: 接口用例运行总/通过/失败数
  - [ ] 右侧: 性能指标
  - [ ] 下方: 测试场景列表(运行状态、场景名称、进度条，可折叠/展开)
  - [ ] 场景展开后: 显示接口请求列表(可折叠/展开)
  - [ ] 点击接口请求，展开查看参数(请求方式、URL 等)
  - [ ] 点击接口请求名称，跳转到场景编排详情
- [ ] WebSocket 实时推送执行进度
- [ ] 运行结束后，支持"再次运行"、导出报告
- [ ] 支持"Allure Report"按钮，点击跳转到 Allure 报告页面
- [ ] 执行记录持久化到测试报告模块

---

### 7. 测试报告 (REPT-001 ~ REPT-005)

#### 7.1 测试报告列表

**功能描述**:
- 列表显示测试报告: 运行状态、运行时间、测试结果、操作列
- 运行状态: 已完成、运行中、已终止、已暂停、失败
- 测试结果以图形形式展示(通过率、失败率)
- 报告信息包含: 场景名称、运行环境、运行时长、运行人

**数据表**:
```sql
CREATE TABLE test_reports (
    id UUID PRIMARY KEY,
    execution_id UUID NOT NULL REFERENCES test_executions(id) ON DELETE CASCADE,
    scenario_id UUID NOT NULL REFERENCES scenarios(id),
    status VARCHAR(50),                   -- passed / failed / skipped
    duration INTEGER,                      -- 耗时(秒)
    result JSONB,                         -- 详细结果
    allure_report_path TEXT,               -- Allure 报告路径
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**验收标准**:
- [ ] 默认显示自定义报告模板
- [ ] 已结束的测试计划支持"Allure Report"按钮，点击跳转
- [ ] Allure 报告默认保存 30 天
- [ ] 操作列: 导出、删除

#### 7.2 历史报告详情

**功能描述**:
- 点击场景名称，下钻到历史报告页面
- 历史报告页面支持: 再次运行、导出报告、Allure 报告、删除、查询、导出
- 历史报告页面与测试计划中的报告运行页面一致

**验收标准**:
- [ ] 历史报告页面与测试计划中的报告运行页面一致
- [ ] 支持再次运行、导出报告、Allure 报告、删除

---

### 8. 全局参数 (GPAR-001 ~ GPAR-004)

#### 8.1 全局参数管理

**功能描述**:
- 封装工具函数
- 使用 Monaco Editor 编写工具函数
- 自动解析 Google docstring，提取: 类名、方法名、功能描述、入参、出参

**数据表**:
```sql
CREATE TABLE global_params (
    id UUID PRIMARY KEY,
    class_name VARCHAR(255) NOT NULL,
    method_name VARCHAR(255) NOT NULL,
    code TEXT NOT NULL,                  -- Python 代码块
    description TEXT,
    parameters JSONB,                    -- 入参释义 [{name, type, description}]
    return_value JSONB,                  -- 出参释义 {type, description}
    created_by UUID NOT NULL REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(class_name, method_name)
);
```

**验收标准**:
- [ ] 全局参数列表显示:
  - [ ] 参数类名(作为目录，可折叠/展开)
  - [ ] 参数方法名(点击进入详情页，有复制按钮)
  - [ ] 功能描述
  - [ ] 入参类型释义
  - [ ] 出参类型释义
  - [ ] 操作列(编辑、删除)
- [ ] 支持创建全局参数(Monaco Editor 编写工具函数)
- [ ] 支持自动解析 docstring，提取: 类名、方法名、功能描述、入参、出参
- [ ] 支持编辑和删除全局参数
- [ ] 保存时弹窗: 显示自动解析结果，确认后保存
- [ ] 功能描述、入参、出参缺失时用 "-" 表示
- [ ] 自动根据类名分配所属目录
- [ ] 初始内置 uuid 函数工具
- [ ] 问号图标提示: 使用 Google docstring 规范

---

## API 规范

### 统一响应格式

```typescript
interface ApiResponse<T> {
  success: boolean      // 请求是否成功
  data?: T              // 响应数据(成功时)
  error?: string        // 错误信息(失败时)
  meta?: {             // 元数据(分页等)
    total: number
    page: number
    limit: number
  }
}
```

### 认证方式

- JWT Token (Bearer Token)
- Token 有效期: 7 天
- 开发模式可跳过认证(APP_ENV=development)

### 请求头规范

```http
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
```

### 核心 API 端点

#### 用户认证模块

```
POST   /api/auth/register           # 邮箱注册
POST   /api/auth/login              # 邮箱登录
GET    /api/auth/github             # GitHub OAuth 重定向
GET    /api/auth/github/callback    # GitHub OAuth 回调
GET    /api/auth/google             # Google OAuth 重定向
GET    /api/auth/google/callback    # Google OAuth 回调
```

#### 项目管理模块

```
GET    /api/projects                # 获取项目列表
POST   /api/projects                # 创建项目
GET    /api/projects/{id}           # 获取项目详情
PUT    /api/projects/{id}           # 更新项目
DELETE /api/projects/{id}           # 删除项目

GET    /api/projects/{id}/databases      # 获取数据库配置列表
POST   /api/projects/{id}/databases      # 创建数据库配置
GET    /api/projects/{id}/databases/{db_id}  # 获取数据库配置详情
PUT    /api/projects/{id}/databases/{db_id}  # 更新数据库配置
DELETE /api/projects/{id}/databases/{db_id}  # 删除数据库配置
POST   /api/projects/{id}/databases/{db_id}/test  # 测试数据库连接
```

#### 关键字配置模块

```
GET    /api/keywords               # 获取关键字列表
POST   /api/keywords               # 创建关键字
GET    /api/keywords/{id}          # 获取关键字详情
PUT    /api/keywords/{id}          # 更新关键字
DELETE /api/keywords/{id}          # 删除关键字
PATCH  /api/keywords/{id}/toggle   # 切换关键字启用状态
```

#### 接口定义模块

```
GET    /api/projects/{id}/interfaces       # 获取接口列表
POST   /api/projects/{id}/interfaces       # 创建接口
GET    /api/projects/{id}/interfaces/{int_id}  # 获取接口详情
PUT    /api/projects/{id}/interfaces/{int_id}  # 更新接口
DELETE /api/projects/{id}/interfaces/{int_id}  # 删除接口
POST   /api/projects/{id}/interfaces/import  # 导入接口(cURL)
POST   /api/projects/{id}/interfaces/debug   # 调试接口
```

#### 场景编排模块

```
GET    /api/scenarios               # 获取场景列表
POST   /api/scenarios               # 创建场景
GET    /api/scenarios/{id}          # 获取场景详情
PUT    /api/scenarios/{id}          # 更新场景
DELETE /api/scenarios/{id}          # 删除场景
POST   /api/scenarios/{id}/debug    # 调试场景

GET    /api/scenarios/{id}/datasets     # 获取测试数据集列表
POST   /api/scenarios/{id}/datasets     # 创建测试数据集
POST   /api/scenarios/{id}/datasets/import  # 导入 CSV
GET    /api/scenarios/{id}/datasets/{ds_id}/export  # 导出 CSV
```

#### 测试计划模块

```
GET    /api/plans                   # 获取测试计划列表
POST   /api/plans                   # 创建测试计划
GET    /api/plans/{id}              # 获取测试计划详情
PUT    /api/plans/{id}              # 更新测试计划
DELETE /api/plans/{id}              # 删除测试计划
POST   /api/plans/{id}/execute      # 执行测试计划
POST   /api/plans/{id}/terminate    # 终止测试执行
POST   /api/plans/{id}/pause        # 暂停测试执行
POST   /api/plans/{id}/resume       # 恢复测试执行
GET    /api/plans/{id}/executions   # 获取执行记录列表
GET    /api/plans/{id}/executions/{exe_id}  # 获取执行记录详情
```

#### 测试报告模块

```
GET    /api/reports                 # 获取测试报告列表
GET    /api/reports/{id}            # 获取测试报告详情
GET    /api/reports/{id}/allure     # 获取 Allure 报告 URL
POST   /api/reports/{id}/export     # 导出测试报告
DELETE /api/reports/{id}            # 删除测试报告
```

#### 全局参数模块

```
GET    /api/global-params           # 获取全局参数列表
POST   /api/global-params           # 创建全局参数
GET    /api/global-params/{id}      # 获取全局参数详情
PUT    /api/global-params/{id}      # 更新全局参数
DELETE /api/global-params/{id}      # 删除全局参数
```

#### WebSocket 端点

```
WS     /ws/executions/{execution_id}  # 实时执行进度推送
```

---

## 非功能性需求

### 性能

- 接口响应时间: P95 < 500ms (非执行类 API)
- 场景执行启动时间: < 3 秒 (点击执行到开始执行)
- 实时进度推送延迟: < 1 秒 (WebSocket)
- 数据驱动并行执行: 支持 10 个并发进程

### 可扩展性

- 用户规模: 支持 100+ 并发用户
- 测试场景数量: 单项目支持 1000+ 场景
- 测试执行历史: 单场景支持 100+ 历史记录

### 安全性

- 密码存储: bcrypt 哈希，加盐存储
- JWT Token: 7 天有效期
- 敏感信息脱敏: 数据库密码、API Token 前端脱敏
- SQL 注入防护: 使用参数化查询
- XSS 防护: 用户输入转义，CSP 策略

### 可靠性

- 系统可用性: >99.5% (月度)
- 数据持久化: PostgreSQL 数据备份(每日)
- 错误处理: 所有 API 统一错误响应格式

### 可用性

- 浏览器支持: Chrome 90+, Firefox 88+, Safari 14+
- 移动端支持: 响应式设计(Phone/Pad)

### 可维护性

- 代码规范: Ruff(后端) + ESLint(前端)
- 测试覆盖率: >80% (pytest)
- 文档完善: README + API 文档 + 部署文档
- 日志规范: 结构化日志(JSON 格式)

---

## 开发环境启动

### 前置依赖

```bash
# Docker 服务 (PostgreSQL/MinIO/Redis)
docker-compose up -d

# 检查服务状态
docker-compose ps
```

### 后端开发

```bash
cd backend

# 安装依赖 (使用 uv)
uv sync

# 环境配置
cp .env.example .env
# 编辑 .env 配置数据库连接、密钥等

# 初始化数据库
python -m app.init_db

# 启动开发服务器
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**API 文档**: http://localhost:8000/docs

### 前端开发

```bash
cd frontend

# 安装依赖
npm install

# 启动开发服务器 (默认端口 3000)
npm run dev

# 构建生产版本
npm run build

# 代码检查
npm run lint
```

**前端地址**: http://localhost:3000

### 核心执行器 (可选)

```bash
cd api-engine

# 安装依赖
uv sync

# 安装 CLI 工具
pip install -e .
```

---

## 测试要求

### 白盒测试

- 使用 pytest
- 覆盖率 ≥ 80%
- 单元测试、集成测试

### 黑盒测试

- 使用 Playwright
- 覆盖核心用户流程

### TDD 开发流程

- 遵循测试驱动开发: 红 → 绿 → 重构
- 先写测试，再实现代码

---

## 项目规范

### 代码规范

- 全程使用 Google 开发范式
- 注释使用中文
- 前端组件样式全局统一(弹窗、分页、查询框、下拉框、暂无数据等)

### 全局文案规范

- 产品设计时考虑合适的文案，不要有歧义
- 全局文案格式规范统一

### 文档管理

- 前端、后端、测试、核心执行器的配置和相关文档都在同一个根目录下维护
- README、CHANGELOG 使用同一个文档

### 标签页管理

- 接口自动化这几个模块均支持对标签页的切换
- 支持关闭全部/当前/其它标签页

### 列表字段筛选

- 所有列表字段中，存在枚举的字段，都支持筛选按钮
- 可重置和确定

---

## 附录

### 核心执行器: sisyphus-api-engine

封装的接口核心执行器，通过 CLI 命令，实现 YAML 文件进行交互。

**功能**:
- 遵循一个 YAML 文件，就是一个完整的测试场景用例
- 支持数据驱动(CSV 文件路径 + YAML 文件中的 ddts 字段)
- 支持文本报告(默认，使用 rich 库)、JSON 响应、Allure 报告、HTML 报告

**工作流程**:

1. 前端将参数传递给后端
2. 后端将参数解析为 YAML 文件，保存在 temp 临时目录中，生成唯一的 UUID 的 YAML 文件名称
3. 调用 sisyphus-api-engine 这个依赖的命令，去执行并得到 JSON 响应数据
4. 后端将 JSON 返回给前端

### Web 自动化 (后续开发)

### App 自动化 (后续开发)

### 消息通知管理 (后续开发)

---

**文档版本**: v1.0.0
**最后更新**: 2026-02-14
