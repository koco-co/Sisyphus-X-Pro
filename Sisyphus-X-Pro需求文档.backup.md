
增加角色使用的skill
产品: product-manager-toolkit (通过这个skill, 生成可供内部的开发和测试人员理解的需求文档就可以)
架构师: architecture-patterns、task-plan
前端: frontend-design
后端: fastapi-backend-template
黑盒测试: webapp-testing
白盒测试: pytest
代码审查: requesting-code-review、react-vite-best-practices
代码提交: git-commit

任务规划.json中新增字段reason, 一开始为空, 后续如果测试阶段, 审查阶段如果未通过, 将status激活时, 需要填写reason.




# Sisyphus-X-Pro 自动化测试管理平台



## 技术架构

### 产品

### 前端

技术栈: vite + react + tailwind css + shadcn/ui + TypeScript

skill: 

### 后端 

技术栈: uv + python 3.12 + ruff + pyright + fastapi + SQLAlchemy + sisyphus-api-engine

### 中间件 

技术栈: postgresql + minIO + redis(docker compose)

### 白盒测试 

技术栈: pytest + requests + uv + python 3.12

### 黑盒测试 

技术栈: playwright + 



## 登录注册

左侧展示SisyphusX平台商标, 字体飘逸,  下方跟上中文的打字机效果, 要与sisyphus这个寓意相结合的文案, 致力于打破sisyphus命运的文案. 整体居中, 动态背景.

右侧显示登录注册页, 支持邮箱登录注册, github、google单点登录

在开发模式下, 默认关闭token验证功能

## 首页

数据可视化信息

## 接口自动化



### 一、项目管理

> 管理项目信息、数据库配置信息. 包含接口项目表, 数据库配置表. 

- 项目管理模块: 列表数据中要有项目名称,项目描述,创建时间, 更新时间, 操作列, 操作列下有编辑图标, 数据库配置图标, 删除图标(点击要二次确认), 还有全局的Toast提示, toast提示窗要有进度条, 要有分页列表. 项目列表中的操作列中有编辑、数据库配置按钮、删除.

- 数据库配置模块: 点击数据库配置按钮, 进入数据库配置下钻页面, 展示列表, 连接名称, 引用变量, 配置信息, 连接状态(默认10分钟自动测试连接一次), 启用状态(默认启用), 目前先适配MySQL和PostgreSQL两个数据库. 需要有测试连接的功能, 测试连接通过后, 可以保存数据库配置. 支持对数据库记录的增删改查操作, 通过添加配置进入弹窗页面, 需要填写: 连接名称, 引用变量, 主机, 端口, 初始数据库, 用户名, 密码. 填写完毕后, 提供测试连接按钮, 需要测试连接成功才能保存并提交表单. 保存成功后, 需要组装配置信息,提交后, 默认启用, 通过按钮开关来设置启用/关闭

- 注意: 数据库表与项目表有关联关系的(数据库的project_id与项目表的id)

### 二、关键字配置

> 配置可扩展的关键字函数, 编辑器使用Monaco编辑器. 在这里扩展后, 可以在后续的下拉框中选中这个. 关键字列表中支持启用字段, 关闭后, 在后续的下拉框中就不会再显示对应关键字了.

- 新增关键字函数时, 需要填写: 关键字类型、名称、方法名、代码块、入参释义(参数名、描述). 保存后, 默认启用, 点击启用按钮, 禁用.
- 内置关键字操作(无法删除和编辑, 且需要把代码回显在前端页面, 当作参考):
  - 发送请求: 支持requests库中所有支持的请求方式(GET、POST等等)
  - 断言类型: 断言对象支持JSON、Header、Cookie、环境变量、HTTP Code、耗时等等.
  - 提取变量: 提取对象支持Json、Header、Cookie .支持jsonpath提取.
  - 数据库操作: 支持选择对应项目下的数据源, 输入SQL命令. 支持数据库断言、提取变量.
  - 自定义操作: 占位符

### 三、接口定义

> 主要是针对单个的测试用例进行快速调试.

根据不同的项目id, 定义接口信息, 环境管理. 支持手动填写, curl导入, swagger导入卡片. 接口调试中的file参数, 需要通过上传到minIO, minIO要根据不同的项目, 将文件上传到不同的桶. 环境管理支持配置多个环境. 参数设置等. 支持{{}}引用这些参数.

- 支持新建目录, 放到指定目录, 目录、接口都可以拖拽排序
- 右上角支持切换环境(显示环境名称), 旁边有个环境管理按钮, 点击进入弹窗页面, 支持定义全局变量(所有环境可用, 手动设置, 提取变量设置)、环境变量(当前环境可用, 手动设置, 也可以通过接口请求中的提取变量进行设置). 环境变量要通过新建环境才能设置, 新建环境需要设置环境名称, 前置URL, 环境变量(选填, 支持填写变量名, 变量值, 变量描述)



### 四、场景编排

> 可以对多个接口进行编排, 形成简单的测试场景.

表: 场景表、步骤表. 包含基础信息、用例信息两部分. 需要与项目id关联. 该模块中, 显示场景列表, 一个场景就相当于一个yaml文件. 支持对测试场景进行增删改查操作.

测试场景列表: 支持增删改查, 分页列表. 

1、支持测试场景名称、所属项目查询

2、列表字段: 所属项目, 测试场景名称, 测试场景描述, 操作列(编辑, 删除)

新增测试场景: 填写基础信息和场景信息

1、基础信息: 包含项目, 名称, 描述, 优先级, 标签.

2、场景信息: 包含测试步骤, 变量定义, 前置SQL, 后置SQL. 支持「环境管理」按钮, 用于快速查看已经保存的全局变量, 环境变量的名称、变量值、变量描述, 全局参数, 可以快速浏览在「系统设置-全局参数」中配置的工具函数.

用例步骤: 可以增删改操作. 点击新增, 填写步骤描述、关键字操作(可以通过下拉框层层筛选出需要的关键字函数), 关键字参数,操作列(编辑, 删除). 选择关键字操作后, 后面就是动态加载对应选项框了, 比如选择「发送请求-HTTP请求」后, 就可以选择该项目中, 在接口定义中保存的HTTP请求(同样支持目录-接口的筛选过程, 也支持按接口名称搜索进行选择). 选择「断言类型-JSON」, 需要填写jsonpath表达式, 判断符号, 预期结果. 选择「提取变量-JSON」, 需要填写变量名称,变量类型(全局 or 环境),jsonpath表达式. 依次类推.

- 测试步骤部分, 支持拖拽改变执行排序

- 支持前置SQL、后置SQL. 使用Monaco编辑器. 用于用例执行的前置sql建表和后置的表删除. 支持变量和参数的引用. 都是通过{{变量名称或参数名称}}去引用. 参数名称支持动态传参和拼接, 比如: source_table_{{random(12)}} . Sisyphus-api-engine核心执行器要处理好这部分的逻辑.

3、支持保存、调试、关闭. 点击调试立马调用sisyphus-api-engine执行并在结束后自动跳转allure报告页面. 调试结果不记录在测试报告中. 也不会持久化. 下一次调试后自动删除. 这就要注意不要把别人的记录删除了, 可以把allure结果放在temp/${登录账号}/report下.

4、右侧边栏支持「运行环境」切换(下拉框右边按钮可以打开环境管理弹窗)、「测试数据集」切换(默认不使用测试数据, 可以选择创建过的数据集. 下拉框右边按钮点击后, 抽屉展开新建数据集页面, 点击新增按钮, 需要输入数据集名称, 然后是数据集的测试数据, 可手动输入、导入csv, 导出csv(无数据时作为导入模版)) . 

5、点击调试时, 数据驱动是并行的, 5行测试数据相当于5个yaml文件. 这块逻辑后端要处理好. 数据集中的数据(包含表头和数据, 一一对应), 在当前关联的接口中, 通过{{变量名}}来实现数据驱动效果.



### 五、测试计划

> 展示测试计划列表, 支持增删改查操作. 可以对多个测试场景进行编排, 形成完整的测试计划. 表: 计划表, 场景表

测试计划列表: 支持增删改查, 分页列表.

1、支持测试计划名称、所属项目查询

2、列表字段: 所属项目、测试计划名称、操作列(编辑、执行、复制、查看图表、删除)



新建测试计划: 基础信息、测试计划

1、基础信息, 包含测试计划名称、所属项目、描述.

2、测试计划, 包含测试场景, Jenkins环境, Webhook配置

- 测试场景: 编排测试场景(支持拖拽排序), 支持对测试场景增删改查操作.

  - 点击添加测试场景, 右侧抽屉展开显示「场景编排」模块中的所有用例(场景名称, 场景描述, 优先级(P0~P3, 默认P2), 标签, 操作(添加按钮)), 支持项目筛选(默认选择基础信息中的所属项目), 还有场景名称搜索. 
  - 支持分页列表显示.
  - 添加场景后, 测试场景列表显示: 场景名称、变量依赖、引用数据集、操作列(编辑、删除)
  - 注意: 测试场景是顺序执行的, 但是数据驱动是并行的, 一行数据相当于一个yaml文件. 这块逻辑后端要处理好.

  

点击执行计划按钮: 下钻到执行计划-${测试计划名称}页面, 列表显示: 场景名称、优先级、标签、运行环境、运行结果(通过、失败、跳过)、创建时间、创建人

1、支持分页、查询. 点击场景名称, 跳转到场景编排中的具体测试场景页

2、鼠标悬浮在运行结果, 可以查看最近的运行时间, 通过指标(通过数、通过率等)、性能指标(耗时)

3、支持选择全部、批量选择测试场景, 右上角点击批量运行按钮. 下钻到自定义的报告页面. 顶部面包屑左侧部分显示${测试计划名称}, 右侧显示终止和暂停. 中间部分左侧实时显示动态运行组件, 旁边展示测试场景运行总/通过/失败数, 接口用例运行总/通过/失败数. 右侧显示相关性能指标. 下方部分列表显示对应测试场景(运行状态、场景名称、运行进度条), 可折叠/展开, 默认折叠. 展开后再显示对应场景下的具体的接口请求, 可折叠/展开. 再点击接口请求, 可以展开查看参数(如请求方式, url等等). 点击接口请求名称, 跳转到场景编排的具体测试场景.

4、运行结束后, 支持「再次运行」、导出报告. 支持「Allure 报告」按钮支持点击, 点击可以跳转到allure报告页面. 该部分的报告记录会持久化到测试报告模块, 在测试报告模块中, 可以查看平台自定义的报告模版, 也可以查看allure报告模版.



### 六、测试报告

> 列表显示测试计划模块中运行的测试结果报告, 支持平台自定义报告, 和allure报告

- 每次运行测试计划后, 都会在这里产生测试报告, 默认显示自定义报告模版, 已结束的测试计划, 支持「Allure Report」按钮点击并跳转. allure报告默认保存30天.
- 列表显示报告信息, 运行状态(已完成、运行中、已终止、已暂停、失败)、运行时间、测试结果(图形形式)、操作列(导出、删除)
- 报告信息中包含: 场景名称, 运行环境, 运行时长, 运行人
- 点击场景名称, 下钻到历史报告页面, 点击支持对报告进行再次运行、导出报告、allure 报告、删除、查询、导出操作. 与测试计划中的报告运行页面一致.





### 核心执行器: sisyphus-api-engine(接口自动化引擎)

> 封装的接口核心执行器, 通过cli命令, 实现yaml文件进行交互. 需要提前定义yaml输入参数与json输出参数的规范文档. 支持文本报告(默认, 使用rich库), json响应, allure报告, html报告.

- 遵循一个yaml文件, 就是一个完整的测试场景用例. 
- 如果有数据驱动的需求, 支持引入csv文件路径、还有在yaml文件中使用ddts字段来实现(都是通过pytest中的parameters装饰器来实现). 在平台中也是这样实现的, 支持下载csv文件模版, 上传csv文件.



### 其它注意事项

如何通过yaml参数去进行接口自动化?

1、前端将参数传递给后端, 后端将参数解析为yaml文件, 保存在temp临时目录中, 生成唯一的uuid的yaml文件名称

2、调用sisyphus-api-engine这个依赖的命令, 去执行并得到json响应数据. 然后将json返回给前端.



### 项目规范

1、项目开发过程中, 全程使用google的开发范式, 注释使用中文.

2、前端项目中的组件样式全局统一, 比如弹窗提示(右上角进度条倒计时)、分页组件、查询框组件、下拉框组件、启用字段样式、暂无数据样式等等

3、产品在设计时, 要考虑合适的文案,不要有歧义. 全局文案格式规范等等要统一.

4、前端、后端、测试、核心执行器的配置和相关文档都在同一个根目录下维护, readme、changelog使用同一个文档.

5、接口自动化这几个模块均支持对标签页的切换, 支持关闭全部/当前/其它标签页

6、所有列表字段中, 存在枚举的字段, 都支持筛选按钮, 可以重置和确定



---

## 系统设置

### 全局参数

> 用于展示并管理封装的工具类. 将内部封装的工具类回显在该模块下. 支持增删改查操作. 比如通过一个uuid封装的函数.

- 展示全局参数列表. 包含参数类名(作为目录, 可折叠/展开), 参数方法名(有复制按钮, 点击方法名进入详情页), 功能描述, 入参类型释义, 出参类型释义, 操作列(编辑, 删除). 编辑就直接在编辑器中编辑代码就可以.

- 支持新增全局参数, Monaco编辑器中编写工具函数(需要给出问号icon, 提示使用规范的google docstring, 解析对应的文本), 在保存时, 出现弹窗: 自动解析类名、方法名、功能描述、入参、出参. 功能描述、入参、出参如果没有, 则用 - 表示. 确定后即可保存. 自动根据类名分配所属目录.
- 初始内置部分全局参数, 比如uuid函数工具.



---



## WEB自动化(后续开发)

### 一、项目管理

### 二、浏览器集群管理

### 三、关键字配置

### 四、项目页面管理

### 五、页面元素管理

### 六、WEB用例信息

### 七、WEB测试计划



---



## APP自动化(后续开发)



---



## 消息通知管理

